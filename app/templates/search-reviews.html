{% extends "layout.html" %}
{% block content %}

<div class="container">
  <div class="row float-element">
    <div class="bm-pd-md">
      {% include 'mobile-navbar.html' %}

      {% if reviews.total > 0 %}
      {% include 'review-list.html' %}
      {% else %}
      <div class="ud-pd-md">
        <p>建议：</p>
        <ul>
          <li>如果您想搜索点评的内容，请输入内容中的任意部分；</li>
          <li>如果您想搜索某个用户的所有点评，请输入作者的用户名；</li>
          <li>如果您想搜索某位老师所有课程的点评，请输入老师的全名；</li>
          <li>如果您想搜索某些课程的点评，请输入部分或全部的课程名称。</li>
        </ul>
      </div>
      {% endif %}
    </div>

  </div><!-- /.float-element -->
</div><!-- /.container -->

{% endblock %}

{% block script %}
{% include 'scripts/review-filter.html' %}
<script>
  $('#inputCourse').focus();
  
  // Handle pagination links with token
  $('nav ul.pagination a').click(function(e) {
    var link = $(this);
    var href = link.attr('href');
    
    // Skip if it's a disabled link or placeholder
    if (!href || href === '#' || link.parent().hasClass('disabled') || link.parent().hasClass('active')) {
      e.preventDefault();
      return false;
    }
    
    e.preventDefault();
    
    // Fetch search token (using POST to prevent caching)
    $.ajax({
      type: "POST",
      url: "{{ url_for('api.get_search_token') }}",
      dataType: "json",
      success: function(res) {
        if (res.ok && res.token) {
          // Add token to URL
          var separator = href.indexOf('?') > -1 ? '&' : '?';
          window.location.href = href + separator + 'token=' + encodeURIComponent(res.token);
        } else {
          alert('无法获取搜索令牌，请稍后重试。');
        }
      },
      error: function(e) {
        alert('无法获取搜索令牌，请稍后重试。');
      }
    });
  });

  // Handle search type switch links (搜点评/搜课程)
  $('.search-switch-link').click(function(e) {
    e.preventDefault();
    var link = $(this);
    var href = link.attr('href');
    
    // Fetch search token (using POST to prevent caching)
    $.ajax({
      type: "POST",
      url: "{{ url_for('api.get_search_token') }}",
      dataType: "json",
      success: function(res) {
        if (res.ok && res.token) {
          // Add token to URL
          var separator = href.indexOf('?') > -1 ? '&' : '?';
          window.location.href = href + separator + 'token=' + encodeURIComponent(res.token);
        } else {
          alert('无法获取搜索令牌，请稍后重试。');
        }
      },
      error: function(e) {
        alert('无法获取搜索令牌，请稍后重试。');
      }
    });
  });
</script>
{% endblock %}
